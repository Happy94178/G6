<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å…©é‡é—œä¿‚èˆ‡æ¯”ï¼šæ•¸å­¸å°è‹±é›„æŒ‘æˆ° - ç¬¬6å–®å…ƒ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Noto Sans TC', sans-serif;
            background-color: #f0f9ff; /* æ·¡è—è‰²èƒŒæ™¯ */
        }
        .game-container {
            max-width: 600px;
            margin: 2rem auto;
            padding: 2rem;
            background-color: white;
            border-radius: 16px;
            box-shadow: 0 10px 20px rgba(0,0,0,0.05);
            position: relative; /* Essential for confetti positioning */
            overflow: hidden; /* To keep confetti inside */
        }
        .level-btn {
            background-color: #3b82f6; /* è—è‰² */
            color: white;
            font-weight: bold;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.3s;
            border: none;
            width: 100%;
            margin-bottom: 0.5rem;
            text-align: center;
        }
        .level-btn:hover {
            background-color: #2563eb;
        }
        .level-btn:disabled {
            background-color: #9ca3af; /* ç°è‰² */
            cursor: not-allowed;
        }
        .question-card {
            padding: 1.5rem;
            background-color: #eff6ff; /* æ·ºè—è‰² */
            border-radius: 12px;
            margin-bottom: 1.5rem;
        }
        .option-btn {
            display: block;
            width: 100%;
            padding: 0.75rem;
            margin-bottom: 0.5rem;
            background-color: white;
            border: 2px solid #93c5fd; /* è—è‰²é‚Šæ¡† */
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: left;
        }
        .option-btn:hover {
            background-color: #dbeafe;
            border-color: #3b82f6;
        }
        .feedback {
            font-size: 1.1rem;
            font-weight: bold;
            padding: 0.5rem;
            border-radius: 8px;
            margin-top: 1rem;
        }
        .correct {
            color: #15803d; /* ç¶ è‰² */
            background-color: #dcfce7;
        }
        .incorrect {
            color: #b91c1c; /* ç´…è‰² */
            background-color: #fee2e2;
        }
        /* ç§»é™¤ Next Question Button çš„æ¨£å¼ï¼Œå› ç‚ºç¾åœ¨æœƒè‡ªå‹•è·³è½‰ */
        
        /* Confetti Styles for the fun effect */
        .confetti {
            position: absolute;
            width: 8px;
            height: 8px;
            opacity: 0;
            pointer-events: none;
            z-index: 10;
        }

        @keyframes confetti-fall {
            0% {
                transform: translateY(0) rotate(0deg);
                opacity: 1;
            }
            100% {
                transform: translateY(600px) rotate(720deg);
                opacity: 0;
            }
        }
    </style>
</head>
<body class="p-4">

    <div class="game-container">
        <!-- æ¨™é¡Œ -->
        <h1 id="game-title" class="text-3xl font-bold text-center text-blue-700 mb-6">å…©é‡é—œä¿‚èˆ‡æ¯”ï¼šæ•¸å­¸å°è‹±é›„æŒ‘æˆ° ğŸš€</h1>
        
        <!-- é—œå¡é¸æ“‡ç•«é¢ -->
        <div id="level-select-screen">
            <h2 class="text-xl font-semibold text-center mb-4">è«‹é¸æ“‡æŒ‘æˆ°é—œå¡</h2>
            <button id="level-1-btn" onclick="startGame(1)" class="level-btn">6-1 èªè­˜åŸºæº–é‡èˆ‡æ¯”è¼ƒé‡</button>
            <button id="level-2-btn" onclick="startGame(2)" class="level-btn" disabled>6-2 æ¯”è¼ƒé‡æœªçŸ¥å•é¡Œ</button>
            <button id="level-3-btn" onclick="startGame(3)" class="level-btn" disabled>6-3 å€çš„é—œä¿‚èˆ‡æ¯”</button>
            <button id="level-4-btn" onclick="startGame(4)" class="level-btn" disabled>6-4 åŸºæº–é‡æœªçŸ¥å•é¡Œ</button>
        </div>

        <!-- éŠæˆ²ç•«é¢ -->
        <div id="game-screen" class="hidden">
            <h2 id="level-title" class="text-2xl font-bold text-blue-600 mb-4"></h2>
            
            <div id="question-container" class="question-card">
                <p id="question-text" class="text-lg mb-4"></p>
                <div id="options-container"></div>
            </div>

            <!-- åé¥‹å€å¡Š - ç­”éŒ¯å¾Œæœƒé¡¯ç¤ºï¼Œä½†ä¸‹ä¸€é¡ŒæŒ‰éˆ•ç§»é™¤ -->
            <div id="feedback-container" class="feedback hidden"></div>
            
            <!-- ç§»é™¤ next-question-btn -->
            <button id="back-to-levels-btn" class="level-btn hidden mt-4" onclick="showLevelSelect()">è¿”å›é—œå¡é¸æ“‡</button>
        </div>

        <!-- å‹åˆ©ç•«é¢ - å¢åŠ è©•åˆ†é¡¯ç¤ºå€å¡Š -->
        <div id="win-screen" class="hidden text-center">
            <h2 class="text-3xl font-bold text-yellow-500 mb-4">ğŸ† æ­å–œä½ ï¼ğŸ†</h2>
            <p id="final-score" class="text-2xl mb-2 font-semibold text-gray-800"></p>
            <p id="final-rating" class="text-xl mb-6 text-blue-600"></p>
            <!-- å‹åˆ©åœ–æ¡ˆ -->
            <img id="win-image" src="https://placehold.co/300x200/22c55e/ffffff?text=Great+Job!+%E2%9C%85" alt="å‹åˆ©åœ–ç‰‡" class="rounded-lg mx-auto mb-6">
            <button class="level-btn" onclick="resetGame()">å†ç©ä¸€æ¬¡</button>
        </div>
    </div>

    <script>
        const allQuestions = {
            1: [
                { 
                    q: "å°ç¿°èº«é«˜ 150 å…¬åˆ†ï¼Œé•·é ¸é¹¿èº«é«˜æ˜¯å°ç¿°çš„ 3 å€ã€‚è«‹å•ã€ŒåŸºæº–é‡ã€æ˜¯èª°çš„èº«é«˜ï¼Ÿ", 
                    o: ["å°ç¿°çš„èº«é«˜", "é•·é ¸é¹¿çš„èº«é«˜", "3 å€"], 
                    a: 0 // ç­”æ¡ˆæ˜¯ç¬¬ä¸€å€‹é¸é … (index 0)
                },
                { 
                    q: "é£²æ–™å°æ¯ 360 æ¯«å‡ï¼Œä¸­æ¯ 500 æ¯«å‡ã€‚å¦‚æœèªªã€Œå°æ¯å®¹é‡æ˜¯ä¸­æ¯å®¹é‡çš„ 0.72 å€ã€ï¼Œè«‹å•ã€Œæ¯”è¼ƒé‡ã€æ˜¯ï¼Ÿ", 
                    o: ["å°æ¯å®¹é‡", "ä¸­æ¯å®¹é‡", "0.72 å€"], 
                    a: 0
                },
                {
                    q: "åœ¨ã€ŒA æ˜¯ B çš„ 5 å€ã€é€™å¥è©±ä¸­ï¼Œç•¶ä½œã€1ã€çš„é‡ (B)ï¼Œè¢«ç¨±ç‚ºï¼Ÿ",
                    o: ["åŸºæº–é‡", "æ¯”è¼ƒé‡", "5 å€"],
                    a: 0 // åŸºæº–é‡ (Base Quantity)
                },
                {
                    q: "åœ¨ã€ŒA æ˜¯ B çš„ 5 å€ã€é€™å¥è©±ä¸­ï¼Œè¢«æ¯”è¼ƒçš„é‡ (A)ï¼Œè¢«ç¨±ç‚ºï¼Ÿ",
                    o: ["åŸºæº–é‡", "æ¯”è¼ƒé‡", "5 å€"],
                    a: 1 // æ¯”è¼ƒé‡ (Compared Quantity)
                },
                {
                    q: "å¦‚ä½•ç®—å‡ºã€Œæ¯”è¼ƒé‡æ˜¯åŸºæº–é‡çš„å¹¾å€ã€ï¼Ÿ",
                    o: ["åŸºæº–é‡ Ã· æ¯”è¼ƒé‡", "æ¯”è¼ƒé‡ Ã— åŸºæº–é‡", "æ¯”è¼ƒé‡ Ã· åŸºæº–é‡"],
                    a: 2 // æ¯”è¼ƒé‡ Ã· åŸºæº–é‡
                }
            ],
            2: [
                { 
                    q: "ç´…ç¹©å­é•· 36 å…¬åˆ†ï¼Œè—ç¹©å­æ˜¯ç´…ç¹©å­çš„ 6 å€é•·ã€‚è—ç¹©å­æœ‰å¤šé•·ï¼Ÿ", 
                    o: ["216 å…¬åˆ†", "6 å…¬åˆ†", "42 å…¬åˆ†"], 
                    a: 0 // 36 * 6 = 216
                },
                { 
                    q: "çš®çš®æœ‰ 100 å…ƒï¼Œä¸¹ä¸¹çš„éŒ¢æ˜¯çš®çš®çš„ 3.2 å€ã€‚å…©äººã€Œå…±æœ‰ã€å¤šå°‘å…ƒï¼Ÿ", 
                    o: ["320 å…ƒ", "420 å…ƒ", "220 å…ƒ"], 
                    a: 1 // 100 * (1 + 3.2) = 420
                },
                {
                    q: "ä¸€ä»¶å•†å“æˆæœ¬ 50 å…ƒï¼Œæˆæœ¬åŠ äºŒæˆä½œç‚ºå®šåƒ¹ã€‚å®šåƒ¹æ˜¯å¤šå°‘å…ƒï¼Ÿ (æç¤ºï¼šäºŒæˆ = 20% = 0.2)",
                    o: ["10 å…ƒ", "50 å…ƒ", "60 å…ƒ"],
                    a: 2 // 50 * (1 + 0.2) = 60
                },
                {
                    q: "çŸ¥é“ã€ŒåŸºæº–é‡ã€å’Œã€Œå€æ•¸ã€ï¼Œå¦‚ä½•ç®—å‡ºã€Œæ¯”è¼ƒé‡ã€ï¼Ÿ",
                    o: ["åŸºæº–é‡ Ã— å€æ•¸", "åŸºæº–é‡ Ã· å€æ•¸", "å€æ•¸ Ã· åŸºæº–é‡"],
                    a: 0 // åŸºæº–é‡ Ã— å€æ•¸
                },
                {
                    q: "A åŸå¸‚ç¶ åœ° 210 å…¬é ƒï¼ŒB åŸå¸‚æ˜¯ A çš„ 0.8 å€ã€‚å…©åŸå¸‚ã€Œç›¸å·®ã€å¤šå°‘å…¬é ƒï¼Ÿ",
                    o: ["168 å…¬é ƒ", "42 å…¬é ƒ", "378 å…¬é ƒ"],
                    a: 1 // 210 * (1 - 0.8) = 42
                }
            ],
            3: [
                { 
                    q: "å¤§ç‹—é«”é‡ 15 å…¬æ–¤ï¼Œå°è²“é«”é‡ 4 å…¬æ–¤ã€‚å¤§ç‹—é«”é‡æ˜¯å°è²“çš„å¹¾å€ï¼Ÿ", 
                    o: ["15 / 4 å€", "4 / 15 å€", "11 å€"], 
                    a: 0 // æ¯”è¼ƒé‡ / åŸºæº–é‡ = 15 / 4
                },
                { 
                    q: "ç”·ç”Ÿäººæ•¸æ˜¯å¥³ç”Ÿçš„ 0.95 å€ã€‚ç”·ç”Ÿå’Œå¥³ç”Ÿäººæ•¸çš„æ¯”å¯ä»¥è¨˜ç‚ºï¼Ÿ(ç”·ç”Ÿ : å¥³ç”Ÿ)", 
                    o: ["0.95 : 1", "1 : 0.95", "1 : 1"], 
                    a: 0 // æ¯”è¼ƒé‡ : åŸºæº–é‡ = (å¹¾å€) : 1
                },
                {
                    q: "ã€Œç”²æ˜¯ä¹™çš„ 1.5 å€ã€ï¼Œç”¨æ¯”ä¾†è¡¨ç¤º (ç”² : ä¹™)ï¼Œä¸”åŸºæº–é‡ (ä¹™) æ˜¯ 1ï¼Œæœƒæ˜¯ï¼Ÿ",
                    o: ["1.5 : 1", "1 : 1.5", "3 : 2"],
                    a: 0 // (å¹¾å€) : 1
                },
                {
                    q: "åœ¨ã€Œ15 : 4ã€é€™å€‹æ¯”ä¸­ï¼Œå®ƒçš„ã€Œæ¯”å€¼ã€(å€æ•¸) æ˜¯å¤šå°‘ï¼Ÿ",
                    o: ["15 / 4", "4 / 15", "15"],
                    a: 0 // 15 Ã· 4
                },
                {
                    q: "å…­å¹´ç”²ç­ç”·ç”Ÿ 16 äººï¼Œå¥³ç”Ÿ 10 äººã€‚ç”·ç”Ÿå’Œã€Œå…¨ç­ã€äººæ•¸çš„æ¯”ï¼ŒåŒ–ç‚ºæœ€ç°¡æ•´æ•¸æ¯”æ˜¯ï¼Ÿ",
                    o: ["8 : 5", "8 : 13", "16 : 26"],
                    a: 1 // 16 : (16 + 10) = 16 : 26 = 8 : 13
                }
            ],
            4: [
                { 
                    q: "å“¥å“¥å­˜äº† 1000 å…ƒï¼Œæ˜¯å¦¹å¦¹çš„ 4 å€ã€‚å¦¹å¦¹å­˜äº†å¤šå°‘å…ƒï¼Ÿ", 
                    o: ["250 å…ƒ", "4000 å…ƒ", "1000 å…ƒ"], 
                    a: 0 // åŸºæº–é‡ = æ¯”è¼ƒé‡ / å€æ•¸ = 1000 / 4
                },
                { 
                    q: "å•†å“æ‰“å…«æŠ˜å¾Œè³£ 1600 å…ƒã€‚è«‹å•ã€Œå®šåƒ¹ã€(åŸåƒ¹)æ˜¯å¤šå°‘å…ƒï¼Ÿ (æç¤ºï¼šå…«æŠ˜ = 0.8 å€)", 
                    o: ["1280 å…ƒ", "2000 å…ƒ", "1600 å…ƒ"], 
                    a: 1 // åŸºæº–é‡(å®šåƒ¹) = æ¯”è¼ƒé‡(å”®åƒ¹) / å€æ•¸ = 1600 / 0.8
                },
                {
                    q: "é¢±é¢¨å¾Œé’æ±Ÿèœæ¼²åƒ¹ 40%ï¼Œæ¼²åƒ¹å¾Œä¸€å…¬æ–¤è³£ 28 å…ƒã€‚åŸä¾†è³£å¤šå°‘å…ƒï¼Ÿ (æç¤ºï¼šæ¼²åƒ¹40% = 1 + 0.4 = 1.4 å€)",
                    o: ["20 å…ƒ", "39.2 å…ƒ", "11.2 å…ƒ"],
                    a: 0 // åŸºæº–é‡(åŸåƒ¹) = æ¯”è¼ƒé‡(å”®åƒ¹) / å€æ•¸ = 28 / 1.4
                },
                {
                    q: "çŸ¥é“ã€Œæ¯”è¼ƒé‡ã€å’Œã€Œå€æ•¸ã€ï¼Œå¦‚ä½•ç®—å‡ºã€ŒåŸºæº–é‡ã€ï¼Ÿ",
                    o: ["æ¯”è¼ƒé‡ Ã— å€æ•¸", "åŸºæº–é‡ Ã· æ¯”è¼ƒé‡", "æ¯”è¼ƒé‡ Ã· å€æ•¸"],
                    a: 2 // æ¯”è¼ƒé‡ Ã· å€æ•¸
                },
                {
                    q: "æœé£¾åº—æ‰“ä¸ƒæŠ˜ï¼Œè¤²å­æ¯”å®šåƒ¹ã€Œä¾¿å®œäº†ã€165 å…ƒã€‚è«‹å•å®šåƒ¹æ˜¯å¤šå°‘å…ƒï¼Ÿ (æç¤ºï¼šä¾¿å®œäº† 1 - 0.7 = 0.3 å€)",
                    o: ["235 å…ƒ", "550 å…ƒ", "115.5 å…ƒ"],
                    a: 1 // åŸºæº–é‡ = 165 / (1 - 0.7) = 550
                }
            ]
        };

        const levelTitles = {
            1: "6-1 èªè­˜åŸºæº–é‡èˆ‡æ¯”è¼ƒé‡",
            2: "6-2 æ¯”è¼ƒé‡æœªçŸ¥å•é¡Œ",
            3: "6-3 å€çš„é—œä¿‚èˆ‡æ¯”",
            4: "6-4 åŸºæº–é‡æœªçŸ¥å•é¡Œ"
        };

        let currentLevel = 0;
        let currentQuestionIndex = 0;
        let levelsCompleted = { 1: false, 2: false, 3: false, 4: false };
        let correctAnswersCount = 0; 
        
        const levelSelectScreen = document.getElementById('level-select-screen');
        const gameScreen = document.getElementById('game-screen');
        const winScreen = document.getElementById('win-screen');
        const levelTitle = document.getElementById('level-title');
        const questionText = document.getElementById('question-text');
        const optionsContainer = document.getElementById('options-container');
        const feedbackContainer = document.getElementById('feedback-container');
        const backToLevelsBtn = document.getElementById('back-to-levels-btn');
        const winImage = document.getElementById('win-image');
        
        // --- Confetti Logic Variables ---
        const confettiColors = ['#fce18a', '#ff726d', '#b486e9', '#63d8cc', '#22c55e'];
        let confettiInterval;
        // ---------------------------------

        function startGame(level) {
            currentLevel = level;
            currentQuestionIndex = 0;
            levelSelectScreen.classList.add('hidden');
            gameScreen.classList.remove('hidden');
            levelTitle.innerText = levelTitles[currentLevel];
            showQuestion();
        }

        function showQuestion() {
            // æ¸…é™¤ä¸Šä¸€é¡Œçš„å…§å®¹
            optionsContainer.innerHTML = '';
            feedbackContainer.classList.add('hidden');
            backToLevelsBtn.classList.add('hidden');
            
            // æª¢æŸ¥æ˜¯å¦é‚„æœ‰å•é¡Œ
            const questionData = allQuestions[currentLevel][currentQuestionIndex];
            
            if (!questionData) {
                // æ­¤é—œå¡çµæŸ
                levelCompleted();
                return;
            }

            questionText.innerText = `ç¬¬ ${currentQuestionIndex + 1} é¡Œ: ${questionData.q}`;

            // é¡¯ç¤ºé¸é …æŒ‰éˆ•
            questionData.o.forEach((option, index) => {
                const button = document.createElement('button');
                button.classList.add('option-btn');
                button.innerText = option;
                // é»æ“Šå¾Œæª¢æŸ¥ç­”æ¡ˆä¸¦ç›´æ¥é€²å…¥ä¸‹ä¸€é¡Œ
                button.onclick = () => checkAnswer(index, questionData.a);
                optionsContainer.appendChild(button);
            });
        }

        function checkAnswer(selectedIndex, correctIndex) {
            // è®“æ‰€æœ‰æŒ‰éˆ•å¤±æ•ˆï¼Œé¿å…é‡è¤‡é»æ“Š
            document.querySelectorAll('.option-btn').forEach(btn => {
                btn.disabled = true;
                btn.style.cursor = 'not-allowed';
            });

            feedbackContainer.classList.remove('hidden');
            
            if (selectedIndex === correctIndex) {
                correctAnswersCount++; // ç­”å°ç¸½æ•¸åŠ  1
                feedbackContainer.innerText = "ç­”å°äº†ï¼ğŸ‘";
                feedbackContainer.className = 'feedback correct';
            } else {
                feedbackContainer.innerText = "ç­”éŒ¯äº†... æ­£ç¢ºç­”æ¡ˆæ˜¯ï¼š" + allQuestions[currentLevel][currentQuestionIndex].o[correctIndex];
                feedbackContainer.className = 'feedback incorrect';
            }
            
            // æ¨™ç¤ºå‡ºæ­£ç¢ºç­”æ¡ˆ
            document.querySelectorAll('.option-btn')[correctIndex].style.backgroundColor = '#dcfce7';
            document.querySelectorAll('.option-btn')[correctIndex].style.borderColor = '#16a34a';
            
            // æ¨™ç¤ºå‡ºéŒ¯èª¤é¸é … (å¦‚æœé¸éŒ¯çš„è©±)
            if (selectedIndex !== correctIndex) {
                document.querySelectorAll('.option-btn')[selectedIndex].style.backgroundColor = '#fee2e2';
                document.querySelectorAll('.option-btn')[selectedIndex].style.borderColor = '#b91c1c';
            }

            // æ ¹æ“šæ–°çš„æµç¨‹ï¼Œ1ç§’å¾Œè‡ªå‹•è·³è½‰åˆ°ä¸‹ä¸€é¡Œ/çµæŸé—œå¡
            setTimeout(() => {
                currentQuestionIndex++;
                showQuestion();
            }, 1000);
        }

        function levelCompleted() {
            levelsCompleted[currentLevel] = true;
            feedbackContainer.innerText = `ğŸ‰ æ­å–œå®Œæˆ ${levelTitles[currentLevel]} é—œå¡ï¼`;
            feedbackContainer.className = 'feedback correct';
            optionsContainer.innerHTML = '';
            questionText.innerText = 'å¤ªå²å®³äº†ï¼';
            backToLevelsBtn.classList.remove('hidden');
            
            updateLevelButtons();
            
            // æª¢æŸ¥æ˜¯å¦æ‰€æœ‰é—œå¡éƒ½å®Œæˆäº†
            if (Object.values(levelsCompleted).every(status => status === true)) {
                setTimeout(showWinScreen, 1500);
            }
        }

        function updateLevelButtons() {
            // è§£é–ä¸‹ä¸€é—œ
            if (levelsCompleted[1]) document.getElementById('level-2-btn').disabled = false;
            if (levelsCompleted[2]) document.getElementById('level-3-btn').disabled = false;
            if (levelsCompleted[3]) document.getElementById('level-4-btn').disabled = false;
            
            // æ¨™ç¤ºå·²å®Œæˆçš„é—œå¡
            for (let level = 1; level <= 4; level++) {
                if (levelsCompleted[level]) {
                    const btn = document.getElementById(`level-${level}-btn`);
                    btn.innerText = `${levelTitles[level]} (å·²å®Œæˆ âœ”ï¸)`;
                    btn.style.backgroundColor = '#16a34a'; // è®Šç¶ è‰²
                }
            }
        }

        function showLevelSelect() {
            stopConfetti(); // åœæ­¢ç‘èŠ±æ•ˆæœ
            gameScreen.classList.add('hidden');
            levelSelectScreen.classList.remove('hidden');
            winScreen.classList.add('hidden');
        }
        
        // --- Confetti Helper Functions ---
        function createConfetti() {
            const confetti = document.createElement('div');
            confetti.classList.add('confetti');
            confetti.style.backgroundColor = confettiColors[Math.floor(Math.random() * confettiColors.length)];
            
            const size = Math.random() * 7 + 5; 
            confetti.style.width = `${size}px`;
            confetti.style.height = `${size}px`;
            confetti.style.borderRadius = Math.random() > 0.5 ? '50%' : '2px';
            
            const gameContainer = document.querySelector('.game-container');
            const containerWidth = gameContainer.offsetWidth;
            const startX = Math.random() * containerWidth;

            confetti.style.left = `${startX}px`;
            confetti.style.top = `-20px`; 
            
            confetti.style.animationName = 'confetti-fall';
            confetti.style.animationDuration = `${Math.random() * 3 + 2}s`; 
            confetti.style.animationDelay = `${Math.random() * 0.5}s`; 
            
            gameContainer.appendChild(confetti);

            setTimeout(() => {
                confetti.remove();
            }, 5000);
        }

        function startConfetti() {
            if (confettiInterval) clearInterval(confettiInterval); 
            
            // Initial burst
            for (let i = 0; i < 30; i++) {
                createConfetti();
            }

            // Continuous stream
            confettiInterval = setInterval(() => {
                for (let i = 0; i < 5; i++) {
                    createConfetti();
                }
            }, 100);
        }
        
        function stopConfetti() {
            if (confettiInterval) clearInterval(confettiInterval);
            document.querySelectorAll('.confetti').forEach(c => c.remove());
        }
        // ---------------------------------

        function showWinScreen() {
            stopConfetti(); // ç¢ºä¿é–‹å§‹æ™‚æ˜¯åœæ­¢ç‹€æ…‹
            gameScreen.classList.add('hidden');
            levelSelectScreen.classList.add('hidden');
            winScreen.classList.remove('hidden');

            const totalQuestions = Object.values(allQuestions).flat().length; // ç¸½é¡Œæ•¸ï¼š5é¡Œ x 4é—œ = 20é¡Œ
            const scoreText = document.getElementById('final-score');
            const ratingText = document.getElementById('final-rating');

            // æ›ç®—æˆç™¾åˆ†æ¯”åˆ†æ•¸ (æ»¿åˆ† 100 åˆ†)
            const scorePercentage = Math.round((correctAnswersCount / totalQuestions) * 100);

            scoreText.innerText = `ä½ çš„å¾—åˆ†æ˜¯ï¼š${correctAnswersCount} / ${totalQuestions} é¡Œ (${scorePercentage} åˆ†)`;

            let ratingMessage = "";
            let imageUrl = "https://placehold.co/300x200/f87171/ffffff?text=Keep+Trying+%E2%9D%8C"; // é è¨­å¤±æ•—åœ–æ¡ˆ
            
            if (scorePercentage === 100) {
                ratingMessage = "ğŸ… æ•¸å­¸å¤§å¸«ï¼ä½ å®Œå…¨æŒæ¡äº†é€™å€‹å–®å…ƒï¼";
                imageUrl = "https://placehold.co/300x200/22c55e/ffffff?text=PERFECT!+%F0%9F%A5%87";
                startConfetti();
            } else if (scorePercentage >= 80) {
                ratingMessage = "â­ è¡¨ç¾å„ªç•°ï¼ä½ å·²ç¶“æ˜¯å¾ˆæ£’çš„æ•¸å­¸å°è‹±é›„ï¼";
                imageUrl = "https://placehold.co/300x200/22c55e/ffffff?text=Great+Job!+%E2%9C%85";
                startConfetti(); // é”åˆ° 80 åˆ†ä»¥ä¸Šï¼Œé–‹å§‹ç‘èŠ±
            } else if (scorePercentage >= 60) {
                ratingMessage = "ğŸ‘ ç¹¼çºŒåŠªåŠ›ï¼å†å¤šç·´ç¿’å¹¾æ¬¡å°±æœƒæ›´æ£’å–”ï¼";
                imageUrl = "https://placehold.co/300x200/facc15/ffffff?text=Nice+Work!";
            } else {
                ratingMessage = "ğŸ’ª æ²’é—œä¿‚ï¼æˆ‘å€‘ä¸€èµ·æ‰¾å‡ºå“ªäº›æ¦‚å¿µéœ€è¦åŠ å¼·ï¼";
            }
            ratingText.innerText = ratingMessage;
            winImage.src = imageUrl; // æ›´æ–°åœ–ç‰‡

        }

        function resetGame() {
            stopConfetti(); // é‡è¨­æ™‚åœæ­¢ç‘èŠ±æ•ˆæœ
            levelsCompleted = { 1: false, 2: false, 3: false, 4: false };
            correctAnswersCount = 0; // é‡è¨­åˆ†æ•¸
            document.getElementById('level-1-btn').disabled = false;
            document.getElementById('level-2-btn').disabled = true;
            document.getElementById('level-3-btn').disabled = true;
            document.getElementById('level-4-btn').disabled = true;
            
            for (let level = 1; level <= 4; level++) {
                const btn = document.getElementById(`level-${level}-btn`);
                btn.innerText = levelTitles[level];
                btn.style.backgroundColor = '#3b82f6'; // æ¢å¾©è—è‰²
            }
            showLevelSelect();
        }
    </script>

</body>
</html>